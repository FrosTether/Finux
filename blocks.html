let cycleStreak = 0; // Persistent streak tracker

async function checkHatch() {
    if (SCORE > 800) { // Elite threshold for Rare Hatch
        cycleStreak++;
        if (cycleStreak >= 3) {
            await mintRareHatch();
            cycleStreak = 0; // Reset streak after rare mint
        } else {
            // Standard Hatchling Reward
            const sh = (Number(localStorage.getItem('sh'))||0) + 1;
            localStorage.setItem('sh', sh);
            pS(2200, 'sine', 0.6); 
        }
    } else {
        cycleStreak = 0; // Streak broken if threshold not met
    }
    SCORE = 0;
}

async function mintRareHatch() {
    const rareId = await gPV(); // Salting with real FTC contract
    const rareNFTs = JSON.parse(localStorage.getItem('rareNFTs') || '[]');
    rareNFTs.push({id: rareId, type: 'Ice Blue Sprite', timestamp: Date.now()});
    localStorage.setItem('rareNFTs', JSON.stringify(rareNFTs));
    
    // Rare Surge Visual & Audio
    document.getElementById('g').classList.add('surge-gold'); 
    pS(432, 'sine', 2.0, 0.4); pS(443.1, 'sine', 2.0, 0.4);
    if(navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 100]);
    setTimeout(() => document.getElementById('g').classList.remove('surge-gold'), 2000);
}
