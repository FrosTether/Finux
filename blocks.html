<!DOCTYPE html>
<html lang="en">
<head>
    <title>FAI | LIQUIDITY_RUN ðŸª¶</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta charset="UTF-8">
    <style>
        :root {
            --bg: #000; --grid: #050505; --cell: #080808;
            --cyan: #00f2ff; --magenta: #ff00ff; --gold: #ffd700;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; font-family: 'Courier New', monospace; }
        body {
            background: var(--bg); color: #fff; height: 100dvh; overflow: hidden;
            display: flex; flex-direction: column; align-items: center;
            background-image: radial-gradient(circle at center, #0a001a 0%, #000 100%);
            touch-action: none;
        }

        /* ðŸª¶ REAL-TIME DATA STREAM BACKGROUND */
        body::before {
            content: 'NODE_SYNC: OK // FTC_CONTRACT: 0xee...8c42 // STATUS: MINING';
            position: fixed; top: 10px; left: 10px; font-size: 8px; color: rgba(0,242,255,0.2);
            white-space: pre; z-index: 0; pointer-events: none;
        }

        .header { width: 360px; display: flex; justify-content: space-between; padding: 20px 0; z-index: 10; border-bottom: 1px solid #1a1a1a; }
        #score { font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--cyan); }
        .status-tag { font-size: 10px; color: var(--gold); text-transform: uppercase; font-weight: bold; }

        .grid-wrap { 
            padding: 6px; background: #111; border-radius: 8px; border: 1px solid #333;
            box-shadow: 0 0 40px rgba(0,0,255,0.1); margin-top: 15px; position: relative;
        }
        #grid {
            display: grid; grid-template-columns: repeat(9, 1fr); gap: 2px;
            width: 360px; height: 360px;
        }

        .cell { background: var(--cell); border-radius: 2px; position: relative; }
        .filled { 
            background: linear-gradient(135deg, var(--gold), #fff); 
            box-shadow: 0 0 15px var(--gold); border: none; z-index: 2;
        }

        .tray { width: 360px; height: 130px; display: flex; justify-content: space-around; align-items: center; margin-top: 20px; }
        .slot { width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; }
        
        /* THE SNAPPY SNAP (ðŸª¶) */
        .drag-active { 
            position: fixed; pointer-events: none; z-index: 1000; 
            transform: translateY(-135px) scale(1.1); 
            filter: brightness(1.2); will-change: transform;
        }

        .btn-sync {
            width: 80%; padding: 20px; margin-top: auto; margin-bottom: 25px;
            border: 1px solid var(--gold); background: #000; color: var(--gold);
            font-weight: 900; letter-spacing: 5px; text-transform: uppercase;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); border-radius: 2px;
        }
    </style>
</head>
<body onload="init()">

<div class="header">
    <div>
        <div style="color:var(--gold); font-size: 14px;">FAI // LIQUIDITY_RUN</div>
        <div class="status-tag" id="status">BUFFER: STANDBY</div>
    </div>
    <div style="text-align:right">
        <small style="color:#666">YIELD SCORE</small>
        <div id="score">0</div>
    </div>
</div>

<div class="grid-wrap"><div id="grid"></div></div>
<div class="tray" id="tray"></div>

<button class="btn-sync" id="startBtn" onclick="igniteEngine()">Establish Secure Link</button>

<script>
    let board = Array(81).fill(0), score = 0, overdrive = 0.15;
    let dragging = null, audio = null, rhythmLog = [];
    const shapes = [[[1,1,1]], [[1,1],[1,1]], [[1,1,1],[0,1,0]], [[1,1,1,1,1]], [[1]], [[1,1,1],[1,1,1]], [[1,1,1],[1,0,0],[1,0,0]]];

    function init() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        for(let i=0; i<81; i++) {
            let c = document.createElement('div'); c.className = 'cell'; c.id = 'c-'+i; g.appendChild(c);
        }
        refreshTray();
    }

    function igniteEngine() {
        if(!audio) {
            audio = new (window.AudioContext || window.webkitAudioContext)();
            setupBinaural(40, -1); setupBinaural(51.11, 1);
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('status').innerText = "11.11Hz SYNCED // MINING ACTIVE";
            setInterval(playRhythm, 1500);
            sfx(528, 'sine', 0.6); 
        }
    }

    function setupBinaural(f, p) {
        let o = audio.createOscillator(), s = audio.createStereoPanner(), g = audio.createGain();
        o.frequency.value = f; s.pan.value = p; g.gain.value = 0.02;
        o.connect(s).connect(g).connect(audio.destination); o.start();
    }

    function playRhythm() {
        if (rhythmLog.length < 2) return;
        rhythmLog.slice(-3).forEach((t, i) => {
            setTimeout(() => sfx(120 + (i * 30), 'square', 0.12), i * 350);
        });
    }

    function sfx(f, type, d) {
        if(!audio) return;
        let o = audio.createOscillator(), g = audio.createGain();
        o.type = type; o.frequency.setValueAtTime(f, audio.currentTime);
        g.gain.setValueAtTime(overdrive, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + d);
        o.connect(g).connect(audio.destination); o.start(); o.stop(audio.currentTime + d);
    }

    function refreshTray() {
        const t = document.getElementById('tray'); t.innerHTML = '';
        for(let i=0; i<3; i++) {
            let s = shapes[Math.floor(Math.random() * shapes.length)];
            let slot = document.createElement('div'); slot.className = 'slot';
            slot.appendChild(renderPiece(s, i, false)); t.appendChild(slot);
        }
    }

    function renderPiece(shape, index, isDrag) {
        const container = document.createElement('div');
        container.style.display = 'grid';
        container.style.gridTemplateColumns = `repeat(${shape[0].length}, ${isDrag ? '38px' : '20px'})`;
        container.style.gap = '2px';
        shape.forEach(row => row.forEach(val => {
            let c = document.createElement('div');
            c.style.width = isDrag ? '38px' : '20px'; c.style.height = isDrag ? '38px' : '20px';
            if(val) c.className = 'cell filled'; else c.style.opacity = '0';
            container.appendChild(c);
        }));
        if(!isDrag) container.ontouchstart = (e) => startDrag(e, shape, index);
        return container;
    }

    function startDrag(e, shape, index) {
        if(!audio) igniteEngine();
        const t = e.touches[0];
        dragging = { shape, index, el: renderPiece(shape, -1, true) };
        dragging.el.classList.add('drag-active');
        document.body.appendChild(dragging.el);
        moveAt(t);
    }

    function moveAt(t) {
        if(!dragging) return;
        dragging.el.style.left = t.clientX - (dragging.el.offsetWidth/2) + 'px';
        dragging.el.style.top = t.clientY + 'px';
        
        document.querySelectorAll('.cell').forEach(c => c.style.background = '');
        const target = document.elementFromPoint(t.clientX, t.clientY - 135);
        if(target && target.classList.contains('cell')) {
            const id = parseInt(target.id.split('-')[1]);
            if(canPlace(id, dragging.shape)) showShadow(id, dragging.shape);
        }
    }

    document.ontouchmove = (e) => { if(dragging) { e.preventDefault(); moveAt(e.touches[0]); } };

    function canPlace(id, s) {
        const r = Math.floor(id/9), c = id%9;
        for(let i=0; i<s.length; i++) for(let j=0; j<s[0].length; j++)
            if(s[i][j]) { let nr=r+i, nc=c+j; if(nr>=9 || nc>=9 || board[nr*9+nc]) return false; }
        return true;
    }

    function showShadow(id, s) {
        const r = Math.floor(id/9), c = id%9;
        s.forEach((row, i) => row.forEach((val, j) => {
            if(val) {
                const target = document.getElementById('c-' + ((r+i)*9 + (c+j)));
                if(target) target.style.background = 'rgba(255, 215, 0, 0.2)';
            }
        }));
    }

    document.ontouchend = (e) => {
        if(!dragging) return;
        const target = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY - 135);
        if(target && target.classList.contains('cell')) {
            const id = parseInt(target.id.split('-')[1]);
            if(canPlace(id, dragging.shape)) {
                placePiece(id, dragging.shape);
                rhythmLog.push(Date.now());
                document.getElementById('tray').children[dragging.index].innerHTML = '';
                if([...document.getElementById('tray').querySelectorAll('.slot')].every(s => s.innerHTML === '')) refreshTray();
            }
        }
        dragging.el.remove(); dragging = null;
    };

    function placePiece(id, s) {
        const r = Math.floor(id/9), c = id%9;
        s.forEach((row, i) => row.forEach((val, j) => {
            if(val) { board[(r+i)*9+c+j]=1; document.getElementById('c-'+((r+i)*9+c+j)).className='cell filled'; }
        }));
        sfx(60, 'square', 0.1); 
        if(navigator.vibrate) navigator.vibrate(15);
        checkClears();
    }

    function checkClears() {
        let rs=[], cs=[], sqs=[];
        for(let i=0; i<9; i++) {
            let rF=true, cF=true;
            for(let j=0; j<9; j++) { if(!board[i*9+j]) rF=false; if(!board[j*9+i]) cF=false; }
            if(rF) rs.push(i); if(cF) cs.push(i);
        }
        for(let y=0; y<9; y+=3) for(let x=0; x<9; x+=3) {
            let sF=true;
            for(let i=0; i<3; i++) for(let j=0; j<3; j++) if(!board[(y+i)*9+(x+j)]) sF=false;
            if(sF) sqs.push({y,x});
        }
        let tot = rs.length + cs.length + sqs.length;
        if(tot > 0) {
            score += tot * 777; // THE JACKPOT CLEAR
            overdrive = Math.min(0.7, overdrive + 0.05);
            document.getElementById('score').innerText = score;
            rs.forEach(r => { for(let c=0; c<9; c++) board[r*9+c]=0; });
            cs.forEach(c => { for(let r=0; r<9; r++) board[r*9+c]=0; });
            sqs.forEach(s => { for(let i=0; i<3; i++) for(let j=0; j<3; j++) board[(s.y+i)*9+(s.x+j)]=0; });
            setTimeout(redraw, 150);
            sfx(880, 'triangle', 0.4);
        }
    }

    function redraw() {
        for(let i=0; i<81; i++) document.getElementById('c-'+i).className = board[i] ? 'cell filled' : 'cell';
    }
</script>
</body>
</html>
